<!doctype html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>BookLab</title>
  <link rel="stylesheet" th:href="@{/app.css}">
</head>
<body>
<div class="container">

  <div class="topbar">
    <div class="brand">
      <div class="logo"></div>
      <div>
        <div class="h1">BookLab</div>
        <div class="subtitle">Hébreu → (Niqqud + FR) via OpenAI • Upload, traite, exporte en PDF</div>
      </div>
    </div>
  </div>

  <div class="grid">
    <div class="card">
      <div class="h2">Nouveau document (images)</div>
      <div class="muted" style="margin-top:-6px">Sélectionne plusieurs photos de pages. Le traitement se fait ensuite dans le document.</div>

      <form method="post" action="/documents" enctype="multipart/form-data" style="margin-top:14px">
        <div class="row">
          <input class="field" name="title" placeholder="Titre (ex: Bereshit - chapitre 1)" />
          <input class="file" type="file" name="files" multiple accept="image/*"/>
          <button class="btn btn-primary" type="submit">Créer</button>
        </div>
      </form>

      <div th:if="${msg != null}" class="alert ok" th:text="${msg}"></div>
      <div th:if="${err != null}" class="alert err" th:text="${err}"></div>
    </div>

    <div class="card">
      <div class="h2">Conseils</div>
      <div class="muted">
        Photo bien droite, bonne lumière, et texte net. Le niqqud est ajouté au mieux : si un mot est ambigu, il peut rester sans voyelles.
      </div>
    </div>
  </div>

  <div class="card">
    <div class="h2">Documents</div>

    <table class="table">
      <thead>
      <tr>
        <th style="width:70px">ID</th>
        <th>Titre</th>
        <th style="width:190px">Statut</th>
        <th style="width:240px">Créé</th>
        <th style="width:280px">Actions</th>
      </tr>
      </thead>

      <tbody>
      <tr th:each="d : ${docs}">
        <td>
          <a class="link" th:href="@{'/documents/' + ${d.id}}">
            #<span th:text="${d.id}"></span>
          </a>
        </td>

        <td th:text="${d.title}"></td>

        <td>
          <span class="badge"
                th:classappend="${d.status.name() == 'DONE' ? ' b-done' : (d.status.name() == 'PROCESSING' ? ' b-proc' : (d.status.name() == 'DONE_WITH_ERRORS' ? ' b-err' : ''))}">
            <span class="dot"></span>
            <span th:text="${d.status}"></span>
          </span>
        </td>

        <td th:text="${d.createdAt}"></td>

        <td>
          <div class="row" style="gap:8px">
            <a class="link" th:href="@{'/documents/' + ${d.id}}">Ouvrir</a>
            <a class="link" th:href="@{'/documents/' + ${d.id} + '/pdf'}">PDF</a>
          </div>
          <div class="muted" style="margin-top:6px">Le lien PDF génère si besoin.</div>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

</div>
</body>
</html>
